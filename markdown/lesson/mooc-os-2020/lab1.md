#Lab 1 操作系统的启动、中断以及函数调用等

***

## 1. 操作系统的启动过程

1. 系统加电，CS与EIP两个寄存器的初始值决定了CPU执行的第一条指令的地址
   * 系统加电后，CS与EIR分别被赋予一默认值: CS=F000H, EIP=0000FFF0H
   * 系统启动时为实模式，实际地址为BASE(CS)+EIP = FFFF0000H+0000FFF0H=FFFFFFF0H
   * 该地址为BIOS的EPROM的所在地
2. BIOS的EPROM所在地
   * 该处的指令为一条长跳转指令，使得CPU跳转至BIOS代码中执行
3. BIOS代码处(1M空间)
   * BIOS完成硬件的初始化与自检
   * BIOS加载存储设备的主引导扇区的512字节到内存的0x7C00地址
   * 最后BIOS使得CPU跳转到0x7C00地址处（Bootloader）继续执行
4. Bootloader（0x7C00）
   * 使能保护模式与段机制
   * 从存储设备中用ELF格式加载OS Kernel，并放在内存固定位置
   * 使得CPU跳转到OS的入口点（Entry Point）执行，控制权交给OS

## 2. 段机制

* 全局描述符表（GDT）
  * 其中每一项为一段描述符
  * 其由Bootloader所建立，由内部的寄存器（GDTR）保存其地址

* 段描述符（Segment Selector）
  * 索引值（index）：通过该索引与相应的段寄存器相联系
  * 起始地址(BASE)：Ucore中默认为0
  * 段大小（LIMIT)：Ucore中默认为4G
* 段寄存器（16位）
  * 索引值（index，13位）：通过该索引与相应的段描述符相联系
  * 特权级（RP，2位）：表明当前寄存器被使用时的特权级别
* 使能保护模式：设置寄存器（CR0）的Bit-0为1，
* 段机制：在保护模式自动开启
* 没有开启页机制时：起始地址（BASE）+偏移地址（EIP）= 线性地址 = 物理地址

# 3. 中断、软中断与异常

* 中断描述符表（IDT）
  * IDT起始地址与大小保存在寄存器IDTR中
  * 其中的每一项被称为中断门与陷阱门
  * 中断门与陷阱门中包含了相应段的选择子，其给出了相应的终端服务历程的地址
* 中断服务历程（ISR）

